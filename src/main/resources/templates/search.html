<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Search Businesses in your area!!</title>
    <th:block th:replace="fragments/common :: styles">Stylesheets</th:block>
</head>
<body>
<nav th:replace="fragments/common :: main_nav">Main navigation</nav>
<main class="container">
    <div class="row">
        <div class="col-xs-12">
            <form action="/search" class="text-center">
                <select class="form-control category input-lg" name="categories">
                    <option
                        th:value="${category.alias}"
                        th:text="${category.title}"
                        th:selected="${category.alias == 'restaurants'}"
                        th:each="category: ${categories}"
                    >
                        Category
                    </option>
                </select>
                <div class="input-group input-group-lg">
                    <input
                        class="form-control"
                        placeholder="Near you..."
                        name="location"
                    />
                    <span class="input-group-btn">
                        <button class="btn btn-primary">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </span>
                </div>
            </form>
        </div>
    </div>
    <div th:if="${result != null}" class="row search-result">
        <div class="col-xs-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Showing
                    <th:block th:text="${criteria.offset() + 1}">1</th:block>
                    -
                    <th:block th:text="${criteria.offset() + result.businesses.size()}">
                        5
                    </th:block>
                    of
                    <th:block th:text="${#numbers.formatInteger(result.total, 0, 'COMMA')}">
                        1600
                    </th:block>
                    <th:block th:if="${pagination.exceedsAPILimit()}">
                        (Only <span th:text="${pagination.last()}">5</span> pages available)
                    </th:block>
                    <th:block th:if="${!pagination.exceedsAPILimit()}">
                        (<span th:text="${pagination.last()}">5</span> pages)
                    </th:block>
                </div>
                <div class="row business" th:each="business: ${result.businesses}">
                    <div class="col-xs-2 text-center">
                        <a th:href="${business.url}">
                            <img
                                class="img-responsive img-rounded business-img"
                                th:src="${business.image}"
                                th:alt="${business.name}"
                            />
                        </a>
                    </div>
                    <div class="col-xs-4">
                        <h4>
                            <a
                                th:href="${'/business/' + business.id}"
                                th:text="${business.name}"
                            >
                                Media heading
                            </a>
                        </h4>
                        <p th:replace="fragments/business :: rating(${business})"></p>
                        <p th:replace="fragments/business :: priceCategories(business=${business}, criteria=${criteria})"></p>
                    </div>
                    <div class="col-xs-4">
                        <div th:replace="fragments/business :: location(${business})"></div>
                        <div th:replace="fragments/business :: phone(${business})"></div>
                    </div>
                    <div
                        class="col-xs-2 business-transaction"
                        th:if="${business.transactions.size() > 0}"
                    >
                        <ul class="transactions">
                            <li th:each="transaction: ${business.transactions}">
                                <span class="label label-default">
                                    <i class="glyphicon glyphicon-tag"></i>
                                    <th:block th:text="${transaction.label}">
                                        Transaction
                                    </th:block>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div
                    class="panel-footer text-center"
                    th:with="limit=${pagination.last() - pagination.currentPage() > 4 ? pagination.currentPage() + 4 : pagination.last()}"
                    th:if="${pagination.hasPages()}"
                >
                    <ul class="pagination">
                        <li th:if="${!pagination.isFirst()}">
                            <a
                                th:href="${criteria.queryStringForPage(pagination.first())}"
                                aria-label="First page"
                                title="First page"
                            >
                                <span>&laquo;</span>
                            </a>
                        </li>
                        <li th:if="${pagination.hasPrevious()}">
                            <a
                                th:href="${criteria.queryStringForPage(pagination.previous())}"
                                aria-label="Previous page"
                                title="Previous page"
                            >
                                <span>&lt;</span>
                            </a>
                        </li>
                        <li
                            th:classappend="${i == pagination.currentPage()} ? 'active' : ''"
                            th:each="i : ${#numbers.sequence(pagination.currentPage(), limit/1)}"
                        >
                            <a
                                th:href="${criteria.queryStringForPage(i)}"
                                th:attr="aria-label=${'Page ' + i}"
                                th:title="${'Page ' + i}"
                            >
                                <span th:text="${i}">1</span>
                            </a>
                        </li>
                        <li th:if="${pagination.hasNext()}">
                            <a
                                th:href="${criteria.queryStringForPage(pagination.next())}"
                                aria-label="Next"
                                title="Next"
                            >
                                <span>&gt;</span>
                            </a>
                        </li>
                        <li th:if="${!pagination.isLast()}">
                            <a
                                th:href="${criteria.queryStringForPage(pagination.last())}"
                                aria-label="Last page"
                                title="Last page"
                            >
                                <span>&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</main>
<th:block th:replace="fragments/common :: scripts">Scripts</th:block>
</body>
</html>